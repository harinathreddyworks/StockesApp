trigger:
  branches:
    include:
      - main

pr:
  branches:
    include:
      - '*'

jobs:
- job: AI_Code_Review
  pool:
    name: 'Default'

  steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.10'

  - script: |
      pip install openai
      python - <<EOF
      import openai, os

      openai.api_key = os.getenv("OPENAI_API_KEY")

      # Example: review code files in the repo
      for root, dirs, files in os.walk("."):
          for file in files:
              if file.endswith((".py", ".js", ".ts", ".html", ".css")):
                  with open(os.path.join(root, file)) as f:
                      content = f.read()
                      prompt = f"Review the following code for bugs, performance issues, and best practices:\n\n{content}"
                      response = openai.ChatCompletion.create(
                          model="gpt-4o-mini",
                          messages=[{"role": "user", "content": prompt}]
                      )
                      print(f"Review for {file}:\n{response.choices[0].message['content']}\n{'-'*60}")
      EOF
    env:
      OPENAI_API_KEY: $(OpenAI_ApiKey)
    displayName: 'Run OpenAI Code Review'
